# DIL: ì´í™í‹°ë¸Œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸

> ìŠ¤í„°ë””: ì›”ê°„ CS, https://github.com/monthly-cs/2024-05-effective-typescript  
> ì‘ì„±ì¼: 2024-05-23  
> ì‘ì„±ì: dusunax

---

## ì•„ì´í…œ 24: ì¼ê´€ì„± ìˆëŠ” ë³„ì¹­ ì‚¬ìš©í•˜ê¸° Be Consistent in Your Use of Aliases

- ë³„ì¹­ì˜ ê°’ì„ ë³€ê²½í•˜ë©´ ì›ë˜ ì†ì„±ê°’ì—ì„œë„ ë³€ê²½ëœë‹¤
  - ì œì–´ íë¦„ì„ ë¶„ì„í•˜ê¸° ì–´ë µë‹¤

```tsx
const place = { name: "New York", latLng: [41.6868, -74.2692] };
const loc = place.latLng; // ë³„ì¹­ alias
```

### ì œì–´ íë¦„ ì˜ˆì‹œ, ë¹„êµ¬ì¡°í™”

```tsx
function isPointInPolygon(polygon: Polygon, pt: Coordinate) {
  if (polygon.bbox) {
    // ë°˜ë³µ ì½”ë“œ
    if (
      pt.x < polygon.bbox.x[0] ||
      pt.x > polygon.bbox.x[1] ||
      pt.y < polygon.bbox.y[0] ||
      pt.y > polygon.bbox.y[1]
    ) {
      return false;
    }
  }

  // ... more complex check
}

function isPointInPolygon(polygon: Polygon, pt: Coordinate) {
  const box = polygon.bbox; // ì„ì‹œ ë³€ìˆ˜ + strictNullChecks
  // boxë¼ëŠ” ë³„ì¹­ì„ ë§Œë“¤ì–´ì„œ ì œì–´ íë¦„ ë¶„ì„ì„ ë°©í•´í–ˆë‹¤

  if (polygon.bbox) {
    box.x[0]; // ì†ì„± ì²´í¬ ë˜ì§€ ì•Šì•˜ìŒ
    //~~~  'box' is possibly 'undefined'
  }

  if (box) {
    box.x[0]; // íƒ€ì… ì²´ì»¤ì— ë¬¸ì œ ì—†ì§€ë§Œ. boxì™€ bboxë¼ëŠ” ê°™ì€ ê°’ì¸ ë° ë‹¤ë¥¸ ì´ë¦„ì„ ì‚¬ìš©í•˜ëŠ” ë³€ìˆ˜ë¥¼ ë§Œë“¤ì—ˆë‹¤
  }

  const { bbox } = polygon; // ê°ì²´ ë¹„êµ¬ì¡°í™”ë¥¼ ì‚¬ìš©í–ˆë‹¤.
  if (bbox) {
    const { x } = bbox; // ë°°ì—´, ì¤‘ì²©ëœ êµ¬ì¡°ì—ì„œë„ ì‚¬ìš©í•œë‹¤
    // ë³´ë‹¤ ê°„ê²°í•œ ë¬¸ë²•ìœ¼ë¡œ ì¼ê´€ëœ ì´ë¦„ ì‚¬ìš©í•˜ê¸°
    // ì„ íƒì  ì†ì„±ì¸ ê²½ìš°, ì†ì„± ì²´í¬ê°€ ë” í•„ìš”. ê²½ê³„ì— nullê°’ ì¶”ê°€
  }
}
```

### ì œì–´ íë¦„ ë¶„ì„ Control Flow Analysis

- ì§€ì—­ ë³€ìˆ˜ì—ì„œëŠ” O. ê°ì²´ ì†ì„±ì—ì„œëŠ” ì£¼ì˜
- ì§€ì—­ ë³€ìˆ˜ë¡œ ë½‘ì•„ì„œ ì‚¬ìš©í•˜ë©´? ë³€ìˆ˜ì˜ íƒ€ì…ì€ ìœ ì§€ë˜ì§€ë§Œ ì›ë˜ ê°ì²´ì˜ ê°’ê³¼ ê°™ê²Œ ìœ ì§€ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

```tsx
const myObj = {
  value: 10,
};

let val = myObj.value;
val += 5;

console.log(`ê°ì²´ì˜ ê°’: ${myObj.value}`); // ê°ì²´ì˜ ê°’: 10
console.log(`ê°’: ${val}`); // ì§€ì—­ ë³€ìˆ˜ì˜ ê°’: 15
```

### Things to Remember

- Aliasing can prevent TypeScript from narrowing types. If you create an alias for a variable, use it consistently.
  - ë³„ì¹­ì€ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ê°€ íƒ€ì…ì„ ì¢íˆëŠ” ê²ƒì„ ë°©í•´í•˜ê¸° ë•Œë¬¸ì—~ ì¼ê´€ì ì¸ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•¨
- Be aware of how function calls can invalidate type refinements on properties. Trust refinements on local variables more than on properties.
  - í•¨ìˆ˜ì˜ í˜¸ì¶œì´ ê°ì²´ ì†ì„±ì˜ `íƒ€ì… ì •ì œ refinements`ë¥¼ ë¬´íš¨í™” í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ì£¼ì˜
  - ì†ì„±ë³´ë‹¤ ì§€ì—­ ë³€ìˆ˜ì˜ íƒ€ì… ì •ì œë¥¼ ë¯¿ìœ¼ì„¸ìš©

## ì•„ì´í…œ 25: ë¹„ë™ê¸° ì½”ë“œì—ëŠ” ì½œë°± ëŒ€ì‹  async í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸° Use async Functions Instead of Callbacks to Improve Type Flow

- ë¹„ë™ê¸° ë™ì‘ì„ ëª¨ë¸ë§ í•˜ê¸° ìœ„í•´ ë§ˆì£¼í–ˆë˜ ì½œë°± ì§€ì˜¥ ğŸ˜ˆ
- ES2015ì˜ Promise ë„ì… ğŸ˜‡ (futureë¼ê³  ë¶€ë¥´ê¸°ë„ í•œë‹¤?)
  - (1)ì½”ë“œ ì¤‘ì²©ì„ ì¤„ì´ê³ , (2)ì‹¤í–‰ ìˆœì„œë¥¼ ì½”ë“œ ìˆœì„œì™€ ê°™ê²Œ í•¨. (3)ì˜¤ë¥˜ ì²˜ë¦¬ê°€ ì‰½ê³  (4)Promise.allê³¼ ê°™ì€ ê¸°ë²• ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

### async function

- await í‚¤ì›Œë“œëŠ” Promiseê°€ resolve(ì²˜ë¦¬)ë  ë•Œê¹Œì§€ í•´ë‹¹ í•¨ìˆ˜ì˜ ì‹¤í–‰ì„ ë©ˆì¶¤
- async í•¨ìˆ˜ ë‚´ì—ì„œ await ì¤‘ì¸ Promiseê°€ reject(ê±°ì ˆ)ë˜ë©´ ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤
  - try/catch

### async function & typescipt

- callbackë³´ë‹¤ promiseë¥¼ ì‚¬ìš©í•  ì´ìœ 
  - ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ë” ì‰½ë‹¤
  - íƒ€ì…ì„ ì¶”ë¡ í•˜ê¸° ë” ì‰½ë‹¤
- Promise.all
  - awiatê³¼ êµ¬ì¡° ë¶„í•´ í• ë‹¹

```tsx
// í”„ë¡œë¯¸ìŠ¤
async function fetchPages() {
  // ê° responseì˜ íƒ€ì…ì„ ì¶”ë¡ 
  const [response1, response2, response3] = await Promise.all([
    fetch(url1),
    fetch(url2),
    fetch(url3),
  ]);
}

// ì½œë°± í•¨ìˆ˜
function fetchPagesWithCallbacks() {
  let numDone = 0;
  const responses: string[] = [];
  const done = () => {
    const [response1, response2, response3] = responses;
  };
  const urls = [url1, url2, url3];
  urls.forEach((url, i) => {
    fetchURL(url, (r) => {
      responses[i] = url;
      numDone++;
      if (numDone === urls.length) done();
    });
  });
  // ì½”ë“œì™€ íƒ€ì… êµ¬ë¬¸ì„ ë” ë§ì´ ì¨ì•¼í•œë‹¤
}
```

### Promise.race

- íƒ€ì„ì•„ì›ƒì„ ì¶”ê°€í•œ íŒ¨í„´

```tsx
/** ì‹œê°„ ë‚´ì— HTTP ìš”ì²­ì„ ì™„ë£Œí•˜ì§€ ëª»í•˜ë©´ "timeout"ì„ timeoutMsì™€ í•¨ê»˜ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ */
function timeout(timeoutMs: number): Promise<never> {
  return new Promise((resolve, reject) => {
    setTimeout(() => reject("timeout"), timeoutMs);
  });
}

// (íƒ€ì…) Promise<Response>ë¡œ ì¶”ë¡ ëœë‹¤
// Promise<Reponse | never>ëŠ”??
// ê³µì§‘í•©(never)ì™€ ìœ ë‹ˆì˜¨ì€ ì•„ë¬´ëŸ° íš¨ê³¼ê°€ ì—†ìœ¼ë¯€ë¡œ => Promise<Response>ë‹¤.
async function fetchWithTimeout(url: string, timeoutMs: number) {
  return Promise.race([fetch(url), timeout(timeoutMs)]); // ë‘˜ ì¤‘ ëˆ„ê°€ ë¨¼ì € ì™„ë£Œë  ê²ƒì¸ê°€?
  // urlê³¼ íƒ€ì„ì•„ì›ƒ ê°’ì„ ë°›ì•„, ì§€ì •ëœ ì‹œê°„ ë‚´ HTTP ìš”ì²­ì„ ì™„ë£Œí•˜ì§€ ëª»í•˜ë©´ ì—ëŸ¬ ë°œìƒ
  // ë§Œì•½ fetchê°€ ë¨¼ì € ì™„ë£Œë˜ë©´? ê²°ê³¼ ë°˜í™˜
  // ë§Œì•½ timoutì´ ë¨¼ì € ì™„ë£Œë˜ë©´? 'timeout' ì—ëŸ¬ ë°˜í™˜
}
```

### new Promiseë³´ë‹¤ async function ì‚¬ìš©í•˜ê¸°

- í”„ë¡œë¯¸ìŠ¤ë¥¼ ìƒì„±í•˜ê¸°ë³´ë‹¤, async/awaitë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
  - async í•¨ìˆ˜ëŠ” Promiseë¥¼ ë°˜í™˜í•œë‹¤!

```tsx
// async í™”ì‚´í‘œ í•¨ìˆ˜ ë§Œë“¤ê¸°
const getNumber = async () => 42;
//    ^? const getNumber: () => Promise<number>

// í”„ë¡œë¯¸ìŠ¤ë¥¼ ì§ì ‘ ìƒì„±í•œë‹¤ë©´
const getNumber = () => Promise.resolve(42);
//    ^? const getNumber: () => Promise<number>
```

- ì¦‰ì‹œ ì‚¬ìš©ê°€ëŠ¥í•œ ê°’ì„ì—ë„ í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜?
  - í•¨ìˆ˜ëŠ” ë™ê¸° or ë¹„ë™ê¸°ë¡œ ì‹¤í–‰ / í˜¼ìš©í•˜ì§€ ì•Šê¸° (ê´€ë¦¬í•˜ê¸° í—¬ì´ ëœë‹¤, async () => Promise<Promise<T>>)
  - ì¤‘ë³µ í”„ë¡œë¯¸ìŠ¤ ë˜í•‘x, ë¹„ë™ê¸° ì½”ë“œì˜ ê°œë… ì¡ê¸°~

```tsx
const _cache: { [url: string]: string } = {};
async function fetchWithCache(url: string) {
  if (url in _cache) {
    return _cache[url];
  }
  const response = await fetch(url); // ì¼ê´€ì ì¸ ë™ì‘ ê°•ì œ
  const text = await response.text(); // await!
  _cache[url] = text;
  return text;
}

let requestStatus: "loading" | "success" | "error";
async function getUser(userId: string) {
  requestStatus = "loading";
  const profile = await fetchWithCache(`/user/${userId}`);
  requestStatus = "success";
}
```

### Things to Remember

- Prefer Promises to callbacks for better composability and type flow.
  - Promiseê°€ callbackë³´ë‹¤ ì½”ë“œ ì‘ì„±ê³¼, íƒ€ì… ì¶”ë¡  ë©´ì—ì„œ ìœ ë¦¬í•˜ë‹¤.
- Prefer async and await to raw Promises when possible. They produce more concise, straightforward code and eliminate whole classes of errors.
  - ê°„ê²°í•˜ê³  ì§ê´€ì ì¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ ì§ì ‘ Promiseë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , async/awaitì„ ì‚¬ìš©í•˜ì
- If a function returns a Promise, declare it async.
  - í”„ë¡œë¯¸ìŠ¤ë¥¼ ë°˜í™˜í•œë‹¤ë©´ asyncë¡œ ì„ ì–¸í•˜ê¸°
