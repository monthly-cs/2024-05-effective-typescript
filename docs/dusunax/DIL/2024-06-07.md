# DIL: ì´í™í‹°ë¸Œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸

> ìŠ¤í„°ë””: ì›”ê°„ CS, https://github.com/monthly-cs/2024-05-effective-typescript  
> ì‘ì„±ì¼: 2024-06-07  
> ì‘ì„±ì: dusunax

---

## ì•„ì´í…œ 43: ëª½í‚¤ íŒ¨ì¹˜ë³´ë‹¤ëŠ” ì•ˆì „í•œ íƒ€ì…ì„ ì‚¬ìš©í•˜ê¸° Prefer Type-Safe Approaches to Monkey Patching

- ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ íŠ¹ì§• ì¤‘ í•˜ë‚˜: ê°ì²´ì™€ í´ë˜ìŠ¤ì— ì„ì˜ì˜ ì†ì„±ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
- ìœ ì—°í•˜ë‹¤.
  - window, documentì— ì „ì—­ ë³€ìˆ˜ ë§Œë“¤ê¸°
  - const el = document.getElementById('colobus'); el.home = 'tree';
  - í”„ë¡œí† íƒ€ì…ì—ë„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
    - í”„ë¡œí† íƒ€ì…ì— ì†ì„±ì„ ì¶”ê°€í•˜ë©´ í•´ë‹¹ ì†ì„±ì´ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì— ìƒì†ë˜ì–´ ë²„ë¦¼
    ```tsx
    RegExp.prototype.monkey = "Capuchin";
    /123/.monkey;
    ```

### ì „ì—­ ê°ì²´ ì¶”ê°€í•˜ê¸°

```tsx
document.monkey = "Tamarin";
//       ~~~~~~ Property 'monkey' does not exist on type 'Document'
(document as any).monkey = "Tamarin"; // ì •ìƒ! í•˜ì§€ë§Œ ì•ˆì „í•˜ì§€ ì•Šë‹¤.

document.addEventListener("DOMContentLoaded", async () => {
  const response = await fetch("/api/users/current-user");
  const user = (await response.json()) as User;
  window.user = user; // OK
});

// ... elsewhere ...
export function greetUser() {
  alert(`Hello ${window.user.name}!`); // OK
}
```

### ì–´ë–»ê²Œ í• ê¹Œ? A. ë³´ê°•!

```tsx
// TypeScriptì—ì„œ Document ì¸í„°í˜ì´ìŠ¤ë¥¼ ì„ ì–¸í•˜ê³  monkey ì†ì„±ì„ ì¶”ê°€
interface Document {
  monkey: string;
}

// ### ê¸€ë¡œë²Œ ë²”ìœ„ì—ì„œ Document ì¸í„°í˜ì´ìŠ¤ë¥¼ ë³´ê°•
// Document ì¸í„°í˜ì´ìŠ¤ë¥¼ í™•ì¥í•˜ì—¬ ì „ì—­ document ê°ì²´ì— monkey ì†ì„±ì„ ì¶”ê°€í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.
// ESModule ê´€ì ì—ì„œ ì œëŒ€ë¡œ ë™ì‘í•˜ë ¤ë©´ global ì„ ì–¸ì´ ìˆì–´ì•¼ í•œë‹¤.

// ### ëª¨ë“ˆ ìŠ¤ì½”í”„ì™€ ê¸€ë¡œë²Œ ìŠ¤ì½”í”„ì˜ ì°¨ì´
// ESModulesì—ì„œëŠ” ê° ëª¨ë“ˆì´ ìì²´ì ì¸ ìŠ¤ì½”í”„ë¥¼ ê°€ì§€ë¯€ë¡œ, ì „ì—­ ê°ì²´ì— ì†ì„±ì„ ì¶”ê°€í•˜ë ¤ë©´ ì´ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸í•´ì•¼ í•œë‹¤.
declare global {
  interface Document {
    monkey: string;
  }
}

document.monkey = "Tamarin";
```

#### ì¥ì 

- íƒ€ì…ì´ ë” ì•ˆì „í•˜ë‹¤. (ì˜¤íƒ€, ì˜ëª»ëœ í• ë‹¹)
- ì†ì„±ì— ì£¼ì„ì„ ë¶™ì¼ ìˆ˜ ìˆë‹¤.
- ì†ì„±ì— ìë™ ì™„ì„±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ëª½í‚¤ íŒ¨ì¹˜ê°€ ì–´ë–¤ ë¶€ë¶„ì— ì ìš©ë˜ì—ˆëŠ”ì§€ ì •í™•í•œ ê¸°ë¡ì´ ë‚¨ëŠ”ë‹¤.

#### ë‹¨ì 

- ë³´ê°•ì€ ì „ì—­ì ìœ¼ë¡œ ì ìš©ë˜ì–´, ì½”ë“œì˜ ë‹¤ë¥¸ ë¶€ë¶„ì´ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œë¶€í„° ë¶„ë¦¬í•  ìˆ˜ ì—†ë‹¤. (í° ë‹¨ì )
- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆì— ì†ì„±ì„ í• ë‹¹í•˜ë©´, ì‹¤í–‰ ì‹œì ì— ë³´ê°•ì„ ì ìš©í•  ìˆ˜ ì—†ë‹¤. HTMLElementë“¤ì„ ì¡°ì‘í•  ê²½ìš° ì–´ë–¤ ì†ì„±ì´ ìˆê±°ë‚˜ ì—†ë‹¤ë©´ ë¬¸ì œê°€ ëœë‹¤. string | undefinedë¡œ ì„ ì–¸í•  ê²½ìš° ë¶ˆí¸í•´ì§„ë‹¤.

```tsx
declare global {
  interface Window {
    /** The currently logged-in user */
    user: User | undefined;
  }
}

// ...
export function greetUser() {
  alert(`Hello ${window.user.name}!`);
  //             ~~~~~~~~~~~ 'window.user' is possibly 'undefined'.
}
```

### B. êµ¬ì²´ì ì¸ íƒ€ì… ë‹¨ì–¸ë¬¸

- í™•ì¥í•´ì„œ ë‹¨ì–¸í•˜ëŠ” ê²½ìš°! ğŸ‘

```tsx
type MyWindow = typeof window & {
  /** The currently logged-in user */
  user: User | undefined;
};
// íƒ€ì… ë‹¨ì–¸ë¬¸ì€ ì •ìƒì´ê³ , í• ë‹¹ë¬¸ì˜ íƒ€ì…ì€ ì•ˆì „í•˜ë‹¤.
// Document íƒ€ì…ì„ ê±´ë“œë¦¬ì§€ ì•Šê³ , ë³„ë„ë¡œ í™•ì¥í•˜ëŠ” ìƒˆë¡œìš´ íƒ€ì…ì„ ë„ì…
// ëª¨ë“ˆ ì˜ì—­ ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆë‹¤. (importí•˜ëŠ” ê³³ì˜ ì˜ì—­ë§Œ í•´ë‹¹ë¨)
// í•˜ì§€ë§Œ~ ëª½í‚¤ íŒ¨ì¹˜ë¥¼ ë‚¨ìš©í•´ì„œëŠ” ì•„ë‹ˆë˜ë©°, ê¶ê·¹ì ìœ¼ë¡œ ë” ì˜ ì„¤ê³„ëœ êµ¬ì¡°ë¡œ ë¦¬íŒ©í„°ë§í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

document.addEventListener("DOMContentLoaded", async () => {
  const response = await fetch("/api/users/current-user");
  const user = (await response.json()) as User;
  (window as MyWindow).user = user; // OK
});

// ...
export function greetUser() {
  alert(`Hello ${(window as MyWindow).user.name}!`);
  //             ~~~~~~~~~~~~~~~~~~~~~~~~~ Object is possibly 'undefined'.
}
```

### Things to Remember

- Prefer structured code to storing data in globals or on the DOM.
  - ì „ì—­ ë³€ìˆ˜ë‚˜ DOMì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³ , ë°ì´í„°ë¥¼ ë¶„ë¦¬í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì§€í–¥í•˜ì.
- If you must store data on built-in types, use one of the type-safe approaches (augmentation or asserting a custom interface).
  - ë‚´ì¥ íƒ€ì…ì— ë°ì´í„°ë¥¼ ì €ì¥í•´ì•¼ í•˜ëŠ” ê²½ìš°, ì•ˆì „í•œ íƒ€ì… ì ‘ê·¼ë²• ì¤‘ í•˜ë‚˜ë¥¼ ì‚¬ìš©í•œë‹¤. (ë³´ê°• augmentation, ì‚¬ìš©ì ì •ì˜ ì¸í„°í˜ì´ìŠ¤ ë‹¨ì–¸ assering a custom interface)
- Understand the scoping issues of augmentations. Include undefined if that's a possibility at runtime.
  - ëª¨ë“ˆ ì˜ì—­ ë¬¸ì œë¥¼ ì´í•´í•˜ì. ëŸ°íƒ€ì„ì— undefinedì¼ ê°€ëŠ¥ì„±ì´ ìˆë‹¤ë©´? í¬í•¨í•˜ì.

## ì•„ì´í…œ 44: íƒ€ì… ì»¤ë²„ë¦¬ì§€ë¥¼ ì¶”ì í•˜ì—¬ íƒ€ì… ì•ˆì •ì„± ìœ ì§€í•˜ê¸° Item 49: Track Your Type Coverage to Prevent Regressions in Type Safety

### ëª…ì‹œì  any íƒ€ì…

- any íƒ€ì…ì„ ì¢íˆê¸° ìœ„í•´ ëª…ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•œ anyëŠ”, ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ë‹¨ìˆœ anyê°€ ë˜ì–´ ì½”ë“œ ì „ë°˜ì„ ì˜¤ì—¼ì‹œí‚´
  - any[], {[key:string]:any}, Record<string, any>
- ê·¸ë ‡ë‹¤ë©´ ê²°êµ­ ì™œ ì“°ëŠ” ê²ƒ?? unknownì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ê² ë‹¤.

### ì„œë“œíŒŒí‹° any íƒ€ì… ì„ ì–¸

- `@types` ì„ ì–¸ íŒŒì¼ë¡œë¶€í„° any íƒ€ì…ì´ ì „íŒŒë˜ê¸° ë•Œë¬¸ì—, ì½”ë“œ ì „ë°˜ì— ì˜í–¥ì„ ë¯¸ì¹œë‹¤.
  - noImplicitAnyë¥¼ ì„¤ì •í•˜ê³ , any ì‘ì„±í•œ ì  ì—†ë”ë¼ë„ ë§ˆì°¬ê°€ì§€~

### any ì¼€ì´ìŠ¤

```tsx
// A. ì–´ë–¤ ì¢…ë¥˜ì˜ column ì •ë³´ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜
function getColumnInfo(name: string): any {
  return utils.buildColumnInfo(appState.dataSchema, name); // Returns any
}

// B. íƒ€ì… ì •ë³´ê°€ ëª¨ë‘ ì œê±°ëœ ìƒíƒœ
// â—ï¸ ì˜ˆì œ ì½”ë“œ í™•ì¸ì´ ì•ˆë¨
// âŒ myModule.d.ts ê°€ ì—†ìœ¼ë©´ ì˜¤ë¥˜

declare module "my-module";
//              ~~~~~~~~~~ Invalid module name in augmentation, module 'my-module' cannot be found.

// âŒ ì‹¤ì œë¡œ ì¡´ì¬í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ declare ì‹œ, íƒ€ì… ì²´ì»¤ê°€ ì¼í•¨
declare module "@next/mdx";
import { notMethod } from "@next/mdx";
//       ~~~~~~~~~ Module '"@next/mdx"' has no exported member 'notMethod'
notMethod();

// âŒ myModule.d.tsê°€ ìˆìœ¼ë©´ íƒ€ì… ì²´ì»¤ê°€ ì¼í•¨.
// myModule.d.ts
declare module "my-module" {
  export function someMethod(): void;
}
// ë‹¤ë¥¸ íŒŒì¼
declare module "my-module";
import { someMethod, notMethod } from "my-module";
//                   ~~~~~~~~~ Module '"my-module"' has no exported member 'notMethod'.
someMethod();
notMethod();

// C. íƒ€ì…ì— ë²„ê·¸ê°€ ìˆëŠ” ê²½ìš°
// ìœ ë‹ˆì˜¨ íƒ€ì…ì„ ë°˜í™˜í•˜ë„ë¡ ì„ ì–¸í•˜ê³ , ì‹¤ì œë¡œëŠ” íŠ¹ì •í•œ ê°’ì„ ë°˜í™˜í•˜ëŠ” ê²½ìš°
// ì„ ì–¸ëœ íƒ€ì…ê³¼ ì‹¤ì œ ë°˜í™˜ëœ íƒ€ì…ì´ ë§ì§€ ì•ŠëŠ” ê²½ìš°?
// anyë¡œ ë‹¨ì–¸ë¬¸ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
```

### `npx type-coverage` anyì˜ ê°¯ìˆ˜ë¥¼ ì¶”ì í•˜ê¸°

- í„°ë¯¸ë„ì—ì„œ percentage(ë°±ë¶„ìœ¨)ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬

```
$ npx type-coverage --detail // any íƒ€ì…ì„ ëª¨ë‘ ì¶œë ¥í•˜ëŠ” ì˜µì…˜
```

- anyê°€ ë” ì´ìƒ í•„ìš” ì—†ê±°ë‚˜, ì‹¤í–‰ë˜ì§€ ì•ŠëŠ” ì½”ë“œì¼ ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ ê¾¸ì¤€íˆ íƒ€ì… ì»¤ë²„ë¦¬ì§€ë¥¼ ì¶”ì í•˜ì—¬ ì ê²€í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ

### Things to Remember

- Even with noImplicitAny set, any types can make their way into your code either through explicit anys or third-party type declarations (@types).
  - noImplicitAnyê°€ ì„¤ì •ë˜ì–´ ìˆì–´ë„ ëª…ì‹œì  any, ì„œë“œíŒŒí‹° íƒ€ì… ì„ ì–¸ì„ í†µí•´ ì½”ë“œ ë‚´ì— ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.
- Consider tracking how well-typed your program is using a tool like type-coverage. This will encourage you to revisit decisions about using any and increase type safety over time.
  - ì‘ì„±í•œ í”„ë¡œê·¸ë¨ì˜ íƒ€ì…ì´ ì–¼ë§ˆë‚˜ ì˜ ì„ ì–¸ë˜ì—ˆëŠ” ì§€ ì¶”ì í•¨ìœ¼ë¡œì„œ => anyì˜ ì‚¬ìš©ì„ ì¤„ì—¬ë‚˜ê°€ë©° íƒ€ì… ì•ˆì •ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤.
    - ì¶”ì  ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ˆì‹œ: type-coverage

```tsx
// ì˜ì–´
augmentation ë³´ê°•
```
