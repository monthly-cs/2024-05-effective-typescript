# DIL: 이펙티브 타입스크립트

> 스터디: 월간 CS, https://github.com/monthly-cs/2024-05-effective-typescript  
> 작성일: 2024-06-20<br/>
> 작성자: iamkanguk97

---

## 아이템57: 소스맵을 사용하여 타입스크립트 디버깅하기

> **타입스크립트 코드를 실행한다 = 타입스크립트 컴파일러가 생성한 자바스크립트 코드를 실행한다는 것 (컴파일러, 압축기, 전처리기 등의 기존 코드를 다른 형태의 코드로 변환하는 도구들도 포함)**<br/>
> 디버깅을 하면 보게되는 코드는 전처리기, 컴파일러, 압축기를 거친 자바스크립트 코드이다. 이 코드는 복잡해서 디버깅하기 매우 어렵다.

디버깅 문제를 해결하기 위해 브라우저 제조사들은 협력해서 `소스맵(Source Map)`이라는 해결책을 만들었다. 소스맵은 변환된 코드의 위치와 심벌들을 원본 코드의 원래 위치와 심벌들로 매핑한다. 대부분의 브라우저와 많은 IDE가 소스맵을 지원한다.

예를 들어 async와 await을 사용한다고 가정한다면 오래된 브라우저에서 async-await을 지원하기 위해 타입스크립트는 이벤트 핸들러를 상태 머신으로 재작성한다. 그리고 아마도 자바스크립트로 소스코드가 변환될 때 엄청 복잡해질 것이다. 만약에 변환된 자바스크립트가 복잡하다면 **소스맵을 적극적으로 활용**해야한다.

**타입스크립트가 소스맵을 생성할 수 있도록 하기 위해 tsconfig.json에 sourceMap 옵션을 추가해주어야 한다.**

```json
{
  "compilerOptions": {
    "sourceMap": true
  }
}
```

**해당 옵션을 가지고 컴파일을 진행하면 .js 파일과 .js.map 2개의 파일이 생성된다.** .js.map 파일이 소스맵 파일이다.

소스맵이 .js파일과 같이 있으면 브라우저의 디버거에서 새로운 index.ts 파일이 생성되는데 여기서 원하는대로 BreakPoint를 설정할 수 있고 변수를 조사할 수 있다.

책에서도 나와있듯이 index.ts가 이태릭 글꼴로 옆에 표시가 될텐데 이는 실제파일이 아니라는 것을 뜻한다. **실제로는 소스맵을 통해 타입스크립트처럼 보이는 것 뿐이다. 그리고 index.js.map 파일이 index.ts 파일의 참조를 포함하거나 파일의 내용을 인라인으로 포함하도록 설정할 수 있어야 한다.**

- 타입스크립트와 함께 번들러나 압축기를 사용하고 있다면 번들러나 압축기가 각자의 소스맵을 생성하게 된다. 이상적인 디버깅 환경이 되려면 생성된 자바스크립트가 아닌 원본 타입스크립트 소스로 매핑되도록 해야한다. 번들러가 기본적으로 타입스크립트를 지원한다면 별도 설정 없이 잘 동작해야 한다. 그렇지 않다면 번들러가 소스맵을 인식할 수 있도록 추가적인 설정이 필요하다.
- **상용 환경에 소스맵이 유출되고 있는지 확인해야 한다.** 디버거를 열지 않는 이상은 소스맵이 로드되지 않으므로 실제 사용자에게 성능 저하는 발생하지 않는다. 하지만 소스맵에 원본 코드의 인라인이 복사본이 포함되어 있다면 공개해서는 안 될 내용이 포함되어 있을 수 있다.

**타입 체커가 코드를 실행하기 전에 많은 오류를 잡아낼 수 있지만 디버거를 대체할 수는 없다. 소스맵을 사용해서 제대로 된 타입스크립트 디버깅 환경을 구축해보자.**

### 🤔요약정리🤔

> **원본 코드가 아닌 변환된 자바스크립트 코드를 디버깅하지 말자. 소스맵을 사용해서 런타임에 타입스크립트 코드를 디버깅하자.**

> **소스맵이 최종적으로 변환된 코드에 완전히 매핑되었는지 확인하자.**

> **소스맵에 원본 코드가 그대로 포함되도록 설정되어 있을 수 있다. 공개되지 않도록 설정을 확인하자.**
